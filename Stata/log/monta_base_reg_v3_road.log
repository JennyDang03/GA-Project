--------------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  \\sbcdf176\PIX_Matheus$\Stata\log\monta_base_reg_v3_road.log
  log type:  text
 opened on:   8 May 2023, 23:35:32

. 
. /*
> *Fake data
> global dta "C:\Users\mathe\Dropbox\RESEARCH\pix\pix-event-study\Stata\dta"
> global output "C:\Users\mathe\Dropbox\RESEARCH\pix\pix-event-study\Output"
> 
> use "C:/Users/mathe/Dropbox/RESEARCH/pix/pix-event-study/Stata/dta/pix/fake_panel_data.dta", clear
> set seed 1234
> gen random=runiform()
> bysort id: gen grupo=cond(random[1]<=1/3,1,cond(random[1]>2/3,3,2))
> drop random
> set seed 1235
> gen random=runiform()
> cap drop muni_cd
> bysort id: gen muni_cd=cond(random[1]<=1/5,1100015,cond(random[1]>2/5,1100023,cond(random[1]>3/5,1100031,cond(random[1]>4/5,1100049,
> 1100056))))
> drop random
> 
> gen mun_cd = muni_cd
> gen after_first_pix_sent = after_adoption
> gen after_first_pix_rec = after_adoption
> gen after_first_pix = after_adoption
> 
> gen dist_bank = expected_distance
> 
> */
. 
. * Add roaddist
. use "$dta\dist_caixa_multiprocess7_osrm.dta"

. 
. * Change names of dist to road_dist
. foreach var of varlist dist_caixa dist_otherbank dist_bank expected_distance{
  2.     rename `var' road_`var'
  3. }

. 
. merge 1:m index using "$dta\Pix_PF_adoption.dta"

    Result                      Number of obs
    -----------------------------------------
    Not matched                       317,484
        from master                   256,791  (_merge==1)
        from using                     60,693  (_merge==2)

    Matched                        14,007,129  (_merge==3)
    -----------------------------------------

. keep if _merge == 3
(317,484 observations deleted)

. drop _merge

. 
. *-------------------------------------------------------------------------------
. * PART 1: Creating new variables and preparing dataset 
. *-------------------------------------------------------------------------------
. 
. tab confidence

 confidence |      Freq.     Percent        Cum.
------------+-----------------------------------
          7 |  6,952,600       49.64       49.64
          8 |  1,463,444       10.45       60.08
          9 |  5,574,014       39.79       99.88
         10 |     17,071        0.12      100.00
------------+-----------------------------------
      Total | 14,007,129      100.00

. drop if confidence <= 8
(8,416,044 observations deleted)

. drop if aux_emerg_jan_mar21 == 1
(2,003 observations deleted)

. 
. *-----------------------------------------------
. * Can you double check whether this is correct?
. gen bf = 0

. replace bf = 1 if grupo == 3
(1,558,312 real changes made)

. label var bf "Bolsa Familia"

. 
. gen cad = 0

. replace cad = 1 if grupo == 1
(863,173 real changes made)

. label var cad "Cad"

. 
. gen extracad = 0

. replace extracad = 1 if grupo == 2
(3,167,597 real changes made)

. label var extracad "ExtraCad"

. 
. keep if bf == 1 | cad == 1 | extracad == 1
(0 observations deleted)

. gen all = 1

. gen non_bf = 0

. replace non_bf = 1 if cad == 1 | extracad == 1
(4,030,770 real changes made)

. label var non_bf "Cad and ExtraCad"

. label var all "All"

. 
. *-----------------------------------------------
. 
. gen after_event  =  time_id >= mofd(mdy(5, 1, 2021))

. gen dist_event = time_id - mofd(mdy(5, 1, 2021))  // MAIO/21 é o tempo zero

. egen id_dist=group(dist_event)

. format %tmNN/CCYY time_id

. labmask id_dist, values(time_id)

. 
. *-----------------------------------------------
. 
. *cap drop log_trans_sent
. *gen log_trans_sent = log(trans_sent) 
. * trans_sent sometimes is 0
. 
. *-----------------------------------------------
. 
. cap drop dist_expec

. gen dist_expec = dist_caixa - expected_distance

. cap drop dist_expec2

. gen dist_expec2 = dist_expec*abs(dist_expec)

. cap drop dist_expec3

. gen dist_expec3 = dist_expec^3

. cap drop dist_caixa2

. gen dist_caixa2 = dist_caixa^2

. cap drop dist_caixa_bank

. gen dist_caixa_bank = dist_caixa - dist_bank

. cap drop dist_caixa_bank2

. gen dist_caixa_bank2 = dist_caixa_bank*abs(dist_caixa_bank)

. cap drop dist_caixa_bank3

. gen dist_caixa_bank3 = dist_caixa_bank^3

. 
. 
. cap drop road_dist_expec

. gen road_dist_expec = road_dist_caixa - road_expected_distance

. cap drop road_dist_expec2

. gen road_dist_expec2 = road_dist_expec*abs(road_dist_expec)

. cap drop road_dist_expec3

. gen road_dist_expec3 = road_dist_expec^3

. cap drop road_dist_caixa2

. gen road_dist_caixa2 = road_dist_caixa^2

. cap drop road_dist_caixa_bank

. gen road_dist_caixa_bank = road_dist_caixa - road_dist_bank

. cap drop road_dist_caixa_bank2

. gen road_dist_caixa_bank2 = road_dist_caixa_bank*abs(road_dist_caixa_bank)

. cap drop road_dist_caixa_bank3

. gen road_dist_caixa_bank3 = road_dist_caixa_bank^3

. 
. *-----------------------------------------------
. * HOW WILL after_first_pix_rec change when date_first_pix_rec is missing? after_pix will be 0
. * Must make sure date_first_pix_rec is the same for all id. 
. 
. foreach var of varlist date_first_pix_rec date_first_pix_sent {
  2.         cap drop temp 
  3.         bysort id : egen temp = min(`var')
  4.         replace `var' = temp if `var' == .
  5. }
(680,386 missing values generated)
(0 real changes made)
(429,252 missing values generated)
(0 real changes made)

. cap drop temp 

. 
. cap drop after_first_pix_rec

. gen after_first_pix_rec = time_id >= date_first_pix_rec

. cap drop after_first_pix_sent

. gen after_first_pix_sent = time_id >= date_first_pix_sent

. cap drop after_first_pix

. gen after_first_pix = min(after_first_pix_rec, after_first_pix_sent)

. 
. *** We will, sometimes, condition the regressions on having send no Pix before april.  
. gen temp = 0

. replace temp = 1 if after_first_pix_sent == 1 & time_id == ym(2021,4)
(68,234 real changes made)

. bysort id: egen previous_takers_sent = max(temp)

. drop temp

. 
. gen temp = 0

. replace temp = 1 if after_first_pix_rec == 1 & time_id == ym(2021,4)
(77,708 real changes made)

. bysort id: egen previous_takers_rec = max(temp)

. drop temp

. 
. gen temp = 0

. replace temp = 1 if after_first_pix == 1 & time_id == ym(2021,4)
(49,373 real changes made)

. bysort id: egen previous_takers = max(temp)

. drop temp

. 
. gen all0 = 0 // 0 For every value, previous_takers == 0 when they didnt adopt in april 2021.

. 
. *-----------------------------------------------
. 
. gen after_adoption = 0

. replace after_adoption = 1 if after_first_pix_rec == 1 & after_first_pix_sent == 1
(2,729,971 real changes made)

. bysort id : egen temp = min(time_id) if after_adoption > 0
(2,859,111 missing values generated)

. bysort id : egen date_adoption = max(temp) 
(1,104,030 missing values generated)

. drop temp

. format %tmNN/CCYY date_adoption

. *-----------------------------------------------
. * Value per transaction
. *gen avg_ticket_sent = 0
. *replace avg_ticket_sent = value_sent/trans_sent if trans_sent > 0
. 
. gen sender = 0

. replace sender = 1 if trans_sent > 0
(2,410,034 real changes made)

. gen receiver = 0

. replace receiver = 1 if trans_rec > 0
(2,505,526 real changes made)

. gen user = 0

. replace user = 1 if trans_rec > 0 | trans_sent > 0
(2,933,856 real changes made)

. *-----------------------------------------------
. 
. 
. gen treat_exp = 0

. replace treat_exp = 1 if dist_caixa > expected_distance
(900,003 real changes made)

. label var treat_exp "Dist Caixa > Exp Dist"

. 
. gen treat_bank = 0

. replace treat_bank = 1 if dist_caixa > dist_bank
(2,695,414 real changes made)

. label var treat_bank "Dist Caixa > Dist Bank"

. 
. gen road_treat_exp = 0

. replace road_treat_exp = 1 if road_dist_caixa > road_expected_distance
(930,553 real changes made)

. label var treat_exp "Road Dist Caixa > Road Exp Dist"

. 
. gen road_treat_bank = 0

. replace road_treat_bank = 1 if road_dist_caixa > road_dist_bank
(2,700,331 real changes made)

. label var treat_bank "Road Dist Caixa > Road Dist Bank"

. 
. *-----------------------------------------------
. cap label var after_adoption "Adoption"

. cap label var after_first_pix_sent "Sender Adoption"

. cap label var after_first_pix_rec "Receiver Adoption"

. cap label var expected_distance "Expected Distance"

. cap label var dist_bank "Dist to Bank"

. cap label var dist_caixa "Dist to Caixa"

. cap label var id "ID"

. cap label var time_id "Month"

. cap label var trans_rec "Transactions Received"

. cap label var trans_sent "Transactions Sent"

. cap label var value_sent "Value Sent"

. cap label var value_rec "Value Received"

. cap label var log_trans_sent "Log Transactions Sent"

. cap label variable dist_expec "Recentered Dist"

. cap label variable dist_expec2 "Recentered Dist^2"

. cap label variable dist_expec3 "Recentered Dist^3"

. cap label variable dist_caixa2  "Dist to Caixa^2"

. cap label variable dist_caixa3  "Dist to Caixa^3"

. cap label variable dist_caixa_bank "DistCaixa-DistBank"

. cap label variable dist_caixa_bank2 "(DistCaixa-DistBank)^2"

. cap label variable dist_caixa_bank3 "(DistCaixa-DistBank)^3"

. cap label variable previous_takers_rec "Previous Receivers"

. cap label variable previous_takers_sent "Previous Senders"

. cap label variable previous_takers "Previous Users"

. cap label variable sender "Senders"

. cap label variable receiver "Receivers"

. cap label variable user "Users"

. 
. cap label var road_dist_bank "Road Dist to Bank"

. cap label var road_dist_caixa "Road Dist to Caixa"

. cap label variable road_dist_expec "Road Recentered Dist"

. cap label variable road_dist_expec2 "Road Recentered Dist^2"

. cap label variable road_dist_expec3 "Road Recentered Dist^3"

. cap label variable road_dist_caixa2  "Road Dist to Caixa^2"

. cap label variable road_dist_caixa3  "Road Dist to Caixa^3"

. cap label variable road_dist_caixa_bank "Road DistCaixa - Road DistBank"

. cap label variable road_dist_caixa_bank2 "(Road DistCaixa - Road DistBank)^2"

. cap label variable road_dist_caixa_bank3 "(Road DistCaixa- Road DistBank)^3"

. * ------------------------------------------------------------------------------
. 
. save "$dta\Pix_PF_adoption_new_variables.dta", replace 
file \\sbcdf176\PIX_Matheus$\Stata\dta\Pix_PF_adoption_new_variables.dta saved

. *save "$dta\fake_panel_data_new_variables_road.dta", replace
. 
. 
. log close
      name:  <unnamed>
       log:  \\sbcdf176\PIX_Matheus$\Stata\log\monta_base_reg_v3_road.log
  log type:  text
 closed on:   8 May 2023, 23:41:10
--------------------------------------------------------------------------------------------------------------------------------------
